title: "Untitled"
author: "Shane Brennan"
date: "2024-05-13"
output: html_document
runtime: shiny
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
knitr::opts_chunk$set(echo = TRUE)
library(shiny)

# Define UI
ui <- fluidPage(
  titlePanel("Input Form"),
  sidebarLayout(
    sidebarPanel(
      textInput("fuel_surcharge", "Fuel Surcharge for the month"),
      textInput("force_majeure_fee", "Force Majeure Fee"),
      textInput("peak_fee", "Peak Fee"),
      actionButton("submit", "Submit")
    ),
    mainPanel(
      verbatimTextOutput("summary"),
      verbatimTextOutput("custom_output") # Adding custom output element
    )
  )
)

# Define server logic
server <- function(input, output) {
  user_data <- reactive({
    list(
      fuel_surcharge = as.numeric(input$fuel_surcharge),
      force_majeure_fee = as.numeric(input$force_majeure_fee),
      peak_fee = as.numeric(input$peak_fee)
    )
  })

  observeEvent(input$submit, {
    # This block will be triggered only when the "Submit" button is clicked
    user_inputs <- user_data()
    output$summary <- renderPrint({
      cat("User Inputs:\n")
      cat("Fuel Surcharge:", user_inputs$fuel_surcharge, "\n")
      cat("Force Majeure Fee:", user_inputs$force_majeure_fee, "\n")
      cat("Peak Fee:", user_inputs$peak_fee, "\n")
    })
  })

  # Custom script to be executed after user input
  output$custom_output <- renderPrint({
    user_inputs <- user_data()
    bill <- read.csv("billing_docs/1013048181-6514511150317568.csv", head=TRUE, sep=",")  # 17 - 28 feb
    sum_qty <- sum(bill$QTY)
    result <- sum_qty * user_inputs$fuel_surcharge
    print(result)
    write.csv(result, file = "result.csv")
  })
}

# Run the application
shinyApp(ui = ui, server = server)


```